"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63],{8063:function(e,t,r){r.d(t,{Z:function(){return l}});var o=r(7437),n=r(2265);function i(e){return 0===e?"0 votes":1===e?"1 vote":"".concat(e," votes")}function s(e,t){return 0===t?0:Math.round(e/t*100)}var a=r(5443);function l(e){let{poll:t,initialVoted:l=!1,initialUpvoted:c=!1}=e,{userId:d}=(0,a.a)(),[u,p]=(0,n.useState)(l),[f,m]=(0,n.useState)(c),[h,v]=(0,n.useState)(null),[x,b]=(0,n.useState)(t),[g,w]=(0,n.useState)(!1),y=x.options.reduce((e,t)=>e+t.votes,0);(0,n.useEffect)(()=>{!d||l||c||(()=>{let e="poll_vote_".concat(x.id),t="poll_upvote_".concat(x.id);localStorage.getItem(e)&&p(!0),localStorage.getItem(t)&&m(!0)})()},[d,x.id,l,c]);let j=async()=>{if(h&&!u&&!g&&d){w(!0);try{let{vote:e}=await Promise.resolve().then(r.bind(r,3562));await e(d,x.id,h)&&(localStorage.setItem("poll_vote_".concat(x.id),h),p(!0),b(e=>{let t=e.options.map(e=>e.id===h?{...e,votes:e.votes+1}:e);return{...e,options:t}}))}catch(e){console.error("Error submitting vote:",e)}finally{w(!1)}}},N=async()=>{if(!f&&!g&&d){w(!0);try{let{upvotePoll:e}=await Promise.resolve().then(r.bind(r,3562));await e(d,x.id)&&(localStorage.setItem("poll_upvote_".concat(x.id),"true"),m(!0),b(e=>({...e,upvotes:e.upvotes+1})))}catch(e){console.error("Error upvoting poll:",e)}finally{w(!1)}}};return(0,o.jsxs)("div",{className:"card overflow-hidden transform transition-all duration-300 hover:translate-y-[-2px] animate-fade-in",children:[(0,o.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,o.jsx)("h3",{className:"text-xl font-semibold text-white",children:x.question}),(0,o.jsxs)("button",{onClick:N,disabled:f||g,className:"flex items-center space-x-2 px-3 py-1.5 rounded-full text-sm transition-all duration-300 \n            ".concat(f?"bg-accent-subtle text-accent-light border border-accent/30":"hover:bg-accent-subtle/50 border border-transparent hover:border-accent/20 text-gray-400 hover:text-accent"),children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 transition-transform duration-300 ".concat(f?"text-accent":"group-hover:translate-y-[-1px]"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),(0,o.jsx)("span",{children:x.upvotes})]})]}),(0,o.jsx)("div",{className:"space-y-3 mb-6",children:x.options.map(e=>(0,o.jsx)("div",{className:"space-y-2",children:u?(0,o.jsxs)("div",{className:"p-4 rounded-xl border border-border bg-surface",children:[(0,o.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,o.jsx)("span",{className:"font-medium text-gray-200",children:e.text}),(0,o.jsxs)("span",{className:"text-accent font-medium",children:[s(e.votes,y),"%"]})]}),(0,o.jsx)("div",{className:"w-full bg-surface-light rounded-full h-3 overflow-hidden",children:(0,o.jsx)("div",{className:"h-3 rounded-full bg-gradient-to-r from-accent to-accent-light transition-all duration-1000 ease-out",style:{width:"".concat(s(e.votes,y),"%")}})}),(0,o.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[e.votes," ",1===e.votes?"vote":"votes"]})]}):(0,o.jsx)("button",{onClick:()=>v(e.id),className:"w-full text-left p-4 rounded-xl border transition-all duration-300 \n                ".concat(h===e.id?"border-accent bg-accent-subtle shadow-subtle":"border-border bg-surface hover:border-border-light hover:bg-surface-light"),children:(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("div",{className:"w-5 h-5 rounded-full border ".concat(h===e.id?"border-accent bg-accent":"border-border"," mr-3 flex items-center justify-center transition-all duration-300"),children:h===e.id&&(0,o.jsx)("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,o.jsx)("span",{className:"".concat(h===e.id?"text-accent-light":"text-gray-300"," transition-colors duration-300"),children:e.text})]})})},e.id))}),!u&&(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mt-4 pt-4 border-t border-border",children:[(0,o.jsx)("span",{className:"text-sm text-gray-400",children:i(y)}),(0,o.jsx)("button",{onClick:j,disabled:!h||g,className:"btn-primary w-full sm:w-auto flex items-center justify-center ".concat(!h||g?"opacity-50 cursor-not-allowed":""),children:g?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Submit Vote"]})})]}),u&&(0,o.jsxs)("div",{className:"flex items-center mt-4 pt-4 border-t border-border text-sm text-gray-400",children:[(0,o.jsx)("svg",{className:"h-4 w-4 text-accent mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,o.jsxs)("span",{children:["You voted - ",i(y)]})]})]})}},5443:function(e,t,r){let o;r.d(t,{UserProvider:function(){return u},a:function(){return p}});var n=r(7437),i=r(2265),s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let a=new Uint8Array(16),l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));var c=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();let n=(e=e||{}).random||(e.rng||function(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(a)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(n)};let d=(0,i.createContext)(void 0);function u(e){let{children:t}=e,[r,o]=(0,i.useState)(""),[s,a]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{let e=localStorage.getItem("userId");e||(e=c(),localStorage.setItem("userId",e)),o(e),a(!0)},[]),s)?(0,n.jsx)(d.Provider,{value:{userId:r},children:t}):null}function p(){let e=(0,i.useContext)(d);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},3562:function(e,t,r){r.d(t,{Kd:function(){return c},mB:function(){return d},upvotePoll:function(){return p},vote:function(){return u},wi:function(){return l}});var o=r(6410),n=r(5978);if(!o.db)throw Error("Firestore is not initialized");let i=(0,n.collection)(o.db,"polls"),s=(0,n.collection)(o.db,"userVotes"),a=(0,n.collection)(o.db,"userUpvotes");async function l(e){if(!o.db)throw Error("Firestore is not initialized");let t=e.options.map(e=>({id:Math.random().toString(36).substring(2,15),text:e,votes:0}));return(await (0,n.ET)(i,{question:e.question,options:t,upvotes:0,createdAt:Date.now()})).id}async function c(e){if(!o.db)throw Error("Firestore is not initialized");let t=(0,n.JU)(o.db,"polls",e),r=await (0,n.QT)(t);if(!r.exists())return null;let i=r.data();return{id:r.id,...i}}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;if(!o.db)throw Error("Firestore is not initialized");try{if(console.log("Querying Firestore for polls..."),!o.db)return console.error("Firestore db is not initialized"),[];let t=(0,n.query)(i,(0,n.Xo)("upvotes","desc"),(0,n.limit)(e)),r=await (0,n.getDocs)(t);return console.log("Found ".concat(r.docs.length," polls")),r.docs.map(e=>{let t=e.data();return{id:e.id,question:t.question||"",options:t.options||[],upvotes:t.upvotes||0,createdAt:t.createdAt||Date.now()}})}catch(e){return console.error("Error getting polls:",e),[]}}async function u(e,t,r){if(!o.db)throw Error("Firestore is not initialized");if(!o.db)return console.error("Firebase DB not initialized"),!1;let i=(0,n.query)(s,(0,n.ar)("userId","==",e),(0,n.ar)("pollId","==",t));if(!(await (0,n.getDocs)(i)).empty)return!1;let a=(0,n.JU)(o.db,"polls",t),l=await (0,n.QT)(a);if(!l.exists())return!1;let c=l.data().options,d=c.findIndex(e=>e.id===r);return -1!==d&&(c[d].votes=c[d].votes+1,await (0,n.r7)(a,{options:c}),await (0,n.ET)(s,{userId:e,pollId:t,optionId:r,votedAt:Date.now()}),!0)}async function p(e,t){if(!o.db)throw Error("Firestore is not initialized");let r=(0,n.query)(a,(0,n.ar)("userId","==",e),(0,n.ar)("pollId","==",t));if(!(await (0,n.getDocs)(r)).empty)return!1;let i=(0,n.JU)(o.db,"polls",t);return!!(await (0,n.QT)(i)).exists()&&(await (0,n.r7)(i,{upvotes:(0,n.nP)(1)}),await (0,n.ET)(a,{userId:e,pollId:t,upvotedAt:Date.now()}),!0)}},6410:function(e,t,r){r.d(t,{db:function(){return c}});var o,n=r(738),i=r(5978),s=r(3301);let a={apiKey:"AIzaSyBtesting123456789",authDomain:"social-poll-app.firebaseapp.com",projectId:"social-poll-app",storageBucket:"social-poll-app.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:abcdef123456"};console.log("Firebase Config:",{apiKey:(null===(o=a.apiKey)||void 0===o?void 0:o.substring(0,5))+"...",projectId:a.projectId});let l=null,c=null;try{l=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)(a),c=(0,i.ad)(l),(0,s.v0)(l),console.log("Firebase initialized successfully with project ID:",a.projectId)}catch(e){console.error("Error initializing Firebase:",e),l=null,c=null}}}]);