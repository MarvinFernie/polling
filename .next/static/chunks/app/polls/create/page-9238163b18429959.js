(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[848],{4499:function(e,t,r){Promise.resolve().then(r.t.bind(r,2972,23)),Promise.resolve().then(r.bind(r,97))},9376:function(e,t,r){"use strict";var o=r(5475);r.o(o,"notFound")&&r.d(t,{notFound:function(){return o.notFound}}),r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}})},97:function(e,t,r){"use strict";r.d(t,{default:function(){return a}});var o=r(7437),n=r(2265),i=r(9376),s=r(3562),l=r(5443);function a(){let e=(0,i.useRouter)(),{userId:t}=(0,l.a)(),[r,a]=(0,n.useState)(""),[u,c]=(0,n.useState)(["",""]),[d,p]=(0,n.useState)(!1),[f,m]=(0,n.useState)(""),h=(e,t)=>{let r=[...u];r[e]=t,c(r)},g=e=>{if(u.length<=2)return;let t=[...u];t.splice(e,1),c(t)},v=async t=>{if(t.preventDefault(),m(""),""===r.trim()){m("Please enter a question");return}let o=u.filter(e=>""!==e.trim());if(o.length<2){m("Please provide at least 2 options");return}p(!0);try{let t=await (0,s.wi)({question:r.trim(),options:o});if(t)e.push("/polls/".concat(t));else throw Error("Failed to create poll")}catch(e){console.error("Error creating poll:",e),m("Failed to create poll. Please try again."),p(!1)}};return(0,o.jsxs)("form",{onSubmit:v,className:"space-y-6",children:[f&&(0,o.jsx)("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg",children:f}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("label",{htmlFor:"question",className:"block text-sm font-medium text-gray-700",children:"Question"}),(0,o.jsx)("input",{type:"text",id:"question",value:r,onChange:e=>a(e.target.value),placeholder:"Ask a question...",className:"input-field w-full",required:!0})]}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Answer Options"}),(0,o.jsx)("button",{type:"button",onClick:()=>{c([...u,""])},className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:"+ Add Option"})]}),u.map((e,t)=>(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsx)("input",{type:"text",value:e,onChange:e=>h(t,e.target.value),placeholder:"Option ".concat(t+1),className:"input-field flex-grow",required:t<2}),u.length>2&&(0,o.jsx)("button",{type:"button",onClick:()=>g(t),className:"text-gray-400 hover:text-red-500",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t))]}),(0,o.jsx)("div",{className:"pt-4",children:(0,o.jsx)("button",{type:"submit",disabled:d,className:"btn-primary w-full ".concat(d?"opacity-50 cursor-not-allowed":""),children:d?"Creating Poll...":"Create Poll"})})]})}},5443:function(e,t,r){"use strict";let o;r.d(t,{UserProvider:function(){return d},a:function(){return p}});var n=r(7437),i=r(2265),s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let l=new Uint8Array(16),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));var u=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();let n=(e=e||{}).random||(e.rng||function(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(l)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]}(n)};let c=(0,i.createContext)(void 0);function d(e){let{children:t}=e,[r,o]=(0,i.useState)(""),[s,l]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{let e=localStorage.getItem("userId");e||(e=u(),localStorage.setItem("userId",e)),o(e),l(!0)},[]),s)?(0,n.jsx)(c.Provider,{value:{userId:r},children:t}):null}function p(){let e=(0,i.useContext)(c);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},3562:function(e,t,r){"use strict";r.d(t,{Kd:function(){return u},mB:function(){return c},upvotePoll:function(){return p},vote:function(){return d},wi:function(){return a}});var o=r(6410),n=r(5978);if(!o.db)throw Error("Firestore is not initialized");let i=(0,n.collection)(o.db,"polls"),s=(0,n.collection)(o.db,"userVotes"),l=(0,n.collection)(o.db,"userUpvotes");async function a(e){if(!o.db)throw Error("Firestore is not initialized");let t=e.options.map(e=>({id:Math.random().toString(36).substring(2,15),text:e,votes:0}));return(await (0,n.ET)(i,{question:e.question,options:t,upvotes:0,createdAt:Date.now()})).id}async function u(e){if(!o.db)throw Error("Firestore is not initialized");let t=(0,n.JU)(o.db,"polls",e),r=await (0,n.QT)(t);if(!r.exists())return null;let i=r.data();return{id:r.id,...i}}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;if(!o.db)throw Error("Firestore is not initialized");try{if(console.log("Querying Firestore for polls..."),!o.db)return console.error("Firestore db is not initialized"),[];let t=(0,n.query)(i,(0,n.Xo)("upvotes","desc"),(0,n.limit)(e)),r=await (0,n.getDocs)(t);return console.log("Found ".concat(r.docs.length," polls")),r.docs.map(e=>{let t=e.data();return{id:e.id,question:t.question||"",options:t.options||[],upvotes:t.upvotes||0,createdAt:t.createdAt||Date.now()}})}catch(e){return console.error("Error getting polls:",e),[]}}async function d(e,t,r){if(!o.db)throw Error("Firestore is not initialized");if(!o.db)return console.error("Firebase DB not initialized"),!1;let i=(0,n.query)(s,(0,n.ar)("userId","==",e),(0,n.ar)("pollId","==",t));if(!(await (0,n.getDocs)(i)).empty)return!1;let l=(0,n.JU)(o.db,"polls",t),a=await (0,n.QT)(l);if(!a.exists())return!1;let u=a.data().options,c=u.findIndex(e=>e.id===r);return -1!==c&&(u[c].votes=u[c].votes+1,await (0,n.r7)(l,{options:u}),await (0,n.ET)(s,{userId:e,pollId:t,optionId:r,votedAt:Date.now()}),!0)}async function p(e,t){if(!o.db)throw Error("Firestore is not initialized");let r=(0,n.query)(l,(0,n.ar)("userId","==",e),(0,n.ar)("pollId","==",t));if(!(await (0,n.getDocs)(r)).empty)return!1;let i=(0,n.JU)(o.db,"polls",t);return!!(await (0,n.QT)(i)).exists()&&(await (0,n.r7)(i,{upvotes:(0,n.nP)(1)}),await (0,n.ET)(l,{userId:e,pollId:t,upvotedAt:Date.now()}),!0)}},6410:function(e,t,r){"use strict";r.d(t,{db:function(){return u}});var o,n=r(738),i=r(5978),s=r(3301);let l={apiKey:"AIzaSyBtesting123456789",authDomain:"social-poll-app.firebaseapp.com",projectId:"social-poll-app",storageBucket:"social-poll-app.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:abcdef123456"};console.log("Firebase Config:",{apiKey:(null===(o=l.apiKey)||void 0===o?void 0:o.substring(0,5))+"...",projectId:l.projectId});let a=null,u=null;try{a=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)(l),u=(0,i.ad)(a),(0,s.v0)(a),console.log("Firebase initialized successfully with project ID:",l.projectId)}catch(e){console.error("Error initializing Firebase:",e),a=null,u=null}}},function(e){e.O(0,[358,139,390,971,117,744],function(){return e(e.s=4499)}),_N_E=e.O()}]);